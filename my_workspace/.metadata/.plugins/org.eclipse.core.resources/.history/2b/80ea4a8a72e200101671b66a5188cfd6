/*
 * stm32f407xx_gpio_driver.c
 *
 *  Created on: 22 Dec 2025
 *      Author: Sayad Hassan
 */

#include "stm32f407xx_gpio_driver.h"


/*********************************************************************
 * @fn      		  - GPIO_PeriClockControl
 *
 * @brief             - This function enables or disables peripheral clock for the given GPIO port
 *
 * @param[in]         - base address of the gpio peripheral
 * @param[in]         - ENABLE or DISABLE macros
 * @param[in]         -
 *
 * @return            -  none
 *
 * @Note              -  none

 */

void GPIO_PeriClockControl(GPIO_RegDef_t *pGPIOxReg, uint8_t EnorDi)
{
	if (EnorDi == ENABLE)
	{
	    if (pGPIOxReg == GPIOA)
	    {
	        GPIOA_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOB)
	    {
	        GPIOB_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOC)
	    {
	        GPIOC_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOD)
	    {
	        GPIOD_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOE)
	    {
	        GPIOE_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOF)
	    {
	        GPIOF_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOG)
	    {
	        GPIOG_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOH)
	    {
	        GPIOH_PERI_CLK_EN();
	    }
	    else if (pGPIOxReg == GPIOI)
	    {
	        GPIOI_PERI_CLK_EN();
	    }
	} else
	{
		if (pGPIOxReg == GPIOA)
		{
			GPIOA_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOB)
		{
			GPIOB_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOC)
		{
			GPIOC_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOD)
		{
			GPIOD_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOE)
		{
			GPIOE_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOF)
		{
			GPIOF_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOG)
		{
			GPIOG_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOH)
		{
			GPIOH_PERI_CLK_DI();
		}
		else if (pGPIOxReg == GPIOI)
		{
			GPIOI_PERI_CLK_DI();
		}
	}

}



/*********************************************************************
 * @fn      		  - GPIO_Init
 *
 * @brief             -
 *
 * @param[in]         -
 * @param[in]         -
 * @param[in]         -
 *
 * @return            -
 *
 * @Note              -

 */

void GPIO_Init(GPIO_Handle_t *pGPIOHandle)
{
	uint32_t temp = 0;

	// 1. Configure GPIOx pin mode


	if (pGPIOHandle->GPIOPinConfig.GPIO_PinMode <= GPIO_MODE_ANALOG)
	{
		// non-interrupt mode

		temp = ( pGPIOHandle->GPIOPinConfig.GPIO_PinMode << (2 * pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );
		pGPIOHandle->pGPIOxReg->MODER &= ~( 0x3 << (2 * pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );  // clearing, 0x3 = binary 11
		pGPIOHandle->pGPIOxReg->MODER |= temp;

	} else
	{
		// interrupt mode
	}


	temp = 0;

	// 2. Configure GPIOx output type
	temp = ( pGPIOHandle->GPIOPinConfig.GPIO_PinOPType << (pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );
	pGPIOHandle->pGPIOxReg->OTYPER &= ~( 1 << pGPIOHandle->GPIOPinConfig.GPIO_PinNumber );  // clearing,
	pGPIOHandle->pGPIOxReg->OTYPER |= temp;

	temp = 0;

	// 3. Configure GPIOx output speed
	temp = ( pGPIOHandle->GPIOPinConfig.GPIO_PinSpeed << (2 * pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );
	pGPIOHandle->pGPIOxReg->OSPEEDR &= ~( 1 << (2 * pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );  // clearing,
	pGPIOHandle->pGPIOxReg->OSPEEDR |= temp;

	temp = 0;

	// 4. Configure GPIOx pull-up/pull-down
	temp = ( pGPIOHandle->GPIOPinConfig.GPIO_PinPuPdControl << (2 * pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );
	pGPIOHandle->pGPIOxReg->PUPDR &= ~( 1 << (2 * pGPIOHandle->GPIOPinConfig.GPIO_PinNumber) );  // clearing,
	pGPIOHandle->pGPIOxReg->PUPDR |= temp;


	// // When Pin mode is NOT Input, General purpose output mode, Alternate function mode, Analog mode

	// 5. Configure GPIOx alternate function

	if(pGPIOHandle->GPIO_PinConfig.GPIO_PinMode == GPIO_MODE_ALTFN)
	{
		unit8_t temp1, temp2;

		temp1 = pGPIOHandle->GPIO_PinConfig.GPIO_PinNumber / 8;
		temp2 = pGPIOHandle->GPIO_PinConfig.GPIO_PinNumber  % 8;

		pGPIOHandle->pGPIOx->AFR[temp1] &= ~(0xF << ( 4 * temp2 ) ); // clearing bits
		pGPIOHandle->pGPIOx->AFR[temp1] |= (pGPIOHandle->GPIO_PinConfig.GPIO_PinAltFunMode << ( 4 * temp2 ) );
	}
}



/*********************************************************************
 * @fn      		  - GPIO_DeInit
 *
 * @brief             -
 *
 * @param[in]         -
 * @param[in]         -
 * @param[in]         -
 *
 * @return            -
 *
 * @Note              -

 */

void GPIO_DeInit(GPIO_RegDef_t *pGPIOxReg)
{
	if(pGPIOx == GPIOA)
	{
		GPIOA_REG_RESET();
	}else if (pGPIOx == GPIOB)
	{
		GPIOB_REG_RESET();
	}else if (pGPIOx == GPIOC)
	{
		GPIOC_REG_RESET();
	}else if (pGPIOx == GPIOD)
	{
		GPIOD_REG_RESET();
	}else if (pGPIOx == GPIOE)
	{
		GPIOE_REG_RESET();
	}else if (pGPIOx == GPIOF)
	{
		GPIOF_REG_RESET();
	}else if (pGPIOx == GPIOG)
	{
		GPIOG_REG_RESET();
	}else if (pGPIOx == GPIOH)
	{
		GPIOH_REG_RESET();
	}else if (pGPIOx == GPIOI)
	{
		GPIOI_REG_RESET();
	}

}













