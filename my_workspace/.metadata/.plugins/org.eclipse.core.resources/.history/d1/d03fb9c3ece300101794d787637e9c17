/*
 * stm32f407xx_spi_driver.c
 *
 *  Created on: 28 Dec 2025
 *      Author: sayad hassan
 */



/*
 * Peripheral Clock setup
 */
void SPI_PeriClockControl(SPI_RegDef_t *pSPIx, uint8_t EnorDi)
{
	if (EnorDi == ENABLE)
	{
	    if (pSPIx == SPI1)      SPI1_PERI_CLK_EN();
	    else if (pSPIx == SPI2) SPI2_PERI_CLK_EN();
	    else if (pSPIx == SPI3) SPI3_PERI_CLK_EN();
	    else if (pSPIx == SPI4) SPI4_PERI_CLK_EN();
	}
	else
	{
		if (pSPIx == SPI1)      SPI1_PERI_CLK_DI();
		else if (pSPIx == SPI2) SPI2_PERI_CLK_DI();
		else if (pSPIx == SPI3) SPI3_PERI_CLK_DI();
		else if (pSPIx == SPI4) SPI4_PERI_CLK_DI();
	}
}



/*
 * Init and De-init
 */
void SPI_Init(SPI_Handle_t *pSPIHandle)
{
	//peripheral clock enable

	SPI_PeriClockControl(pSPIHandle->pSPIx, ENABLE);



	uint16_t temp = 0;

	if(pSPIHandle->SPIPinConfig.DeviceMode == SPI_DEVICE_MODE_MASTER)
	{
		temp |= (1 << SPI_CR1_MSTR);
	}
	else
	{
		temp &= ~(1 << SPI_CR1_MSTR);
	}


	if(pSPIHandle->SPIPinConfig.BusConfig == SPI_DEVICE_BUS_MODE_FD)
	{
		temp &= ~(1 << SPI_CR1_BIDIMODE);
		temp &= ~(1 << SPI_CR1_RXONLY);
	}
	else if(pSPIHandle->SPIPinConfig.BusConfig == SPI_DEVICE_BUS_MODE_HD)
	{
		temp |= (1 << SPI_CR1_BIDIMODE);
	}
	else if(pSPIHandle->SPIPinConfig.BusConfig == SPI_DEVICE_BUS_MODE_SIMPLEX_TXONLY)
	{
		temp |= (1 << SPI_CR1_BIDIOE);
	}
	else if(pSPIHandle->SPIPinConfig.BusConfig == SPI_DEVICE_BUS_MODE_SIMPLEX_RXONLY)
	{
		temp &= ~(1 << SPI_CR1_BIDIOE);
		temp |= (1 << SPI_CR1_RXONLY);
	}


	if(pSPIHandle->SPIPinConfig.CPHA == SPI_CPHA_HIGH)
	{
		temp |= (1 << SPI_CR1_CPHA);
	}
	else
	{
		temp &= ~(1 << SPI_CR1_CPHA);
	}


	if(pSPIHandle->SPIPinConfig.CPOL == SPI_CPOL_HIGH)
	{
		temp |= (1 << SPI_CR1_CPOL);
	}
	else
	{
		temp &= ~(1 << SPI_CR1_CPOL);
	}


	if(pSPIHandle->SPIPinConfig.DFF == SPI_DATA_FORMAT_16_BIT)
	{
		temp |= (1 << SPI_CR1_DFF);
	}
	else
	{
		temp &= ~(1 << SPI_CR1_DFF);
	}


	if(pSPIHandle->SPIPinConfig.SSM == SPI_SSM_EN)
	{
		temp |= (1 << SPI_CR1_SSM);
	}
	else
	{
		temp &= ~(1 << SPI_CR1_SSM);
	}


	if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV2)
	{
	    temp |= (0x0 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV4)
	{
	    temp |= (0x1 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV8)
	{
	    temp |= (0x2 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV16)
	{
	    temp |= (0x3 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV32)
	{
	    temp |= (0x4 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV64)
	{
	    temp |= (0x5 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV128)
	{
	    temp |= (0x6 << SPI_CR1_BR);
	}
	else if(pSPIHandle->SPIPinConfig.BR == SPI_BR_DIV256)
	{
	    temp |= (0x7 << SPI_CR1_BR);
	}


	pSPIHandle->pSPIx = temp;

}


